#!/bin/bash

if [ $# -eq 0 ] ; then
        echo "Please supply one or more filenames to process" >&2
        exit 1
fi

#
# wrap a call with a printout.
#
run()
{
        echo "$*"
        $@
}

ASTYLE="/home/zglue/bin/astyle"
TARGET_DIR="$HOME/src/zglue/official/nuttx-official/arch/arm/src/imxrt"
[ ! -d "$TARGET_DIR" ] && TARGET_DIR="$HOME/src/zeus/NuttX/nuttx-official/arch/arm/src/imxrt"
pushd $TARGET_DIR || exit

declare -A Styles
Styles["nuttx"]="/home/zglue/bin/astyle-nuttx"

date +"== %m::%S::%h-%d"
ls -l test.c

CMD=( "git" "checkout" "." )
run ${CMD[@]}

CMD=( "git" "status" )
run ${CMD[@]}

ls -l test.c
CMD=( "$ASTYLE" "--options=${Styles[nuttx]}" "$@" )
run "${CMD[@]}"

popd


#!/bin/bash

trap indent RETURN

STEP="   "
INDENT=""

indent()
{
        [ "$1" = "+" ] && INDENT="${STEP}${INDENT}" && return
        INDENT="${INDENT%%      }"
        dbg && echo "Indent decremented to ${#INDENT}" >&2
}

#
#
#
function dbg
{
        [ "$DEBUG" = "1" ] || return 1
        return 0
}

#
# Show what functions is executing
# and what args were passed.
#
function Func
{
        dbg || return
        indent "+"
        echo -e "${#INDENT}:${INDENT} :: ${#FUNCNAME[@]} ===> ${FUNCNAME[1]}() $@" >&2
}

#
# Preview changes:
#
make_docs()
{
        Func $@

        make clean && make docs && (cd _build/html && python3 -m SimpleHTTPServer 8080)
}

#
# Install Sphinx toolchain:
#
sphinx_tools_install()
{
        Func $@
        sudo apt-get install  python3-breathe python3-recommonmark 
}

#
# 
#
preview()
{
        Func $@
        cd docs
        make clean && make preview && (cd _build/html && python3 -m SimpleHTTPServer 8080)
        INDENT="${INDENT%	}"
}

#
# List possible args.
#
list_funcs()
{
        Func $@
        declare -a LIST

        indent "+"
        LIST=( $(grep "()$" $0 | sed -e 's/^/        /') )
        for i in $(seq 0 $(( ${#LIST[@]} - 1)) ); do
                 echo -e "${INDENT} :: ${LIST[$i]}"
        done
        indent "-"

}

#
#
#
help()
{
    Func $@
    list_funcs
}

#
#
#
function parse
{
    Func $@

    [ $# -eq 0 ] && ARG="-h"
    while [ $# -ne 0 ] ; do
        ARG=$1
        case "$ARG" in
        -h)     help
                exit
                ;;
        *)
                ;;
        esac
        shift
    done

    INDENT="${INDENT%	}"
}

function boo
{
        Func $@
        echo "func call to see whether indent the func works."
        indent
}

[ -n "$1" ] && parse "$@"
$@

boo

#!/bin/bash


GERRIT_HOST=101.132.142.37
GERRIT_SSH_PORT=30149
GERRIT_HTTP_PORT=14586
ZGLUE_BILL_HOST=git@github.com/zglue-bill
GIT_UNAME=bill
SDK_13="SDK_13.0.0-1"
SDK_13_1="SDK_13.1.0"
SDK_14="SDK_14.0.0"
DIALOG_SDK=dialog_585_sdk_dev

declare -A Repo2Host
declare -A RepoRename

RepoRename["riot"]=RIOT
RepoRename["apps"]=nuttx_apps
RepoRename["dialog"]=dialog_585_sdk_dev@3rd_Party_SDK
RepoRename["dallas"]=dialog_585_sdk_dev@3rd_Party_SDK
RepoRename["nordic"]=SDK_13.0.0-1@3rd_Party_SDK
RepoRename["sdk_13_1"]=SDK_13.1.0@3rd_Party_SDK
RepoRename["sdk_14"]=SDK_14.0.0@3rd_Party_SDK

# Repo2Host["mynewt-tools"]master@https://github.com/apache/mynewt-newt.git
# Repo2Host["mynewt"]=master@https://github.com/apache/mynewt-core.git
# https://github.com/koalaman/shellcheck.git
Repo2Host["zephyr"]=master@github.com/zephyrproject-rtos/zephyr.git
Repo2Host["RIOT"]=master@github.com/RIOT-OS
Repo2Host["bknuttx"]=master@bitbucket.org/nuttx
Repo2Host["sdk_13"]=$SDK_13@$GIT_UNAME@$GERRIT_HOST:$GERRIT_SSH_PORT
Repo2Host["sdk_14"]=$SDK_14@$GIT_UNAME@$GERRIT_HOST:$GERRIT_SSH_PORT
Repo2Host["nordic"]=$SDK_13_1@$GIT_UNAME@$GERRIT_HOST:$GERRIT_SSH_PORT
Repo2Host["dialog"]=$DIALOG_SDK@$GIT_UNAME@$GERRIT_HOST:$GERRIT_SSH_PORT
Repo2Host["nuttx"]=zdk@$GIT_UNAME@$GERRIT_HOST:$GERRIT_SSH_PORT
Repo2Host["nuttx_apps"]=zdk@$GIT_UNAME@$GERRIT_HOST:$GERRIT_SSH_PORT
Repo2Host["apps"]=zdk@$GIT_UNAME@$GERRIT_HOST:$GERRIT_SSH_PORT
Repo2Host["auto_test"]=master@$GIT_UNAME@$GERRIT_HOST:$GERRIT_SSH_PORT
Repo2Host["3rd_Party_SDK"]=master@$GIT_UNAME@$GERRIT_HOST:$GERRIT_SSH_PORT
Repo2Host["fw_devtools"]=master@$ZGLUE_BILL_HOST
Repo2Host["home-env"]=master@$ZGLUE_BILL_HOST

#
# Quick writeup of what keywords map to what repos.
#
info()
{
        echo -e "\tKeyword\t\tRepo\t\tBranch"
        echo -e "\t3rd_Party_SDK\t3rd_Party_SDK :: master"
        echo -e "\tnordic\t\t3rd_Party_SDK :: SDK_13.1.0"
        echo -e "\tsdk_13_1\t3rd_Party_SDK :: SDK_13.1.0"
        echo -e "\tsdk_13\t\t3rd_Party_SDK :: SDK_13.0.0-1"
        echo -e "\tsdk_14\t\t3rd_Party_SDK :: SDK_14.0.0"
        echo ""
        echo -e "\tdallas\t\t3rd_Party_SDK :: dialog_585_sdk_dev"
        echo ""
        echo -e "\tapps\t\tnuttx_apps :: zdk"
        echo -e "\tnuttx_apps\tnuttx_apps :: zdk"
        echo -e "\tnuttx\t\tnuttx :: zdk"
        echo -e "\tbknuttx\t\toffcial nuttx :: master"
        echo -e "\tauto_test\tauto_test :: master"
}

#
# Given a keyword or hint from the user find the branch,
# repo, and URI associated and clone.
#
function clone()
{
        local CMD=
        local Proto=
        local Branch=
        local Uri=
        local RepoName=

        [ -z "$1" ] && return 1
        RepoName=${1%%.git}
        [ -n "${RepoRename[${RepoName,,}]}" ] && RepoName=${RepoRename[${RepoName,,}]}
        if [ "${RepoName%%@*}" != "${RepoName}" ] ; then
                Branch=${RepoName##@*}
                RepoName=${RepoName##*@}
        else
                Branch=${Repo2Host[$RepoName]}
        fi
        Proto=ssh
        Branch=${Branch%%@*}
        Uri=${Repo2Host[$RepoName]}
        Uri=${Uri#*@}
        CMD="git clone -b $Branch ssh://$Uri/$RepoName"
        echo "$CMD"
        $CMD
}

if [ $# -eq 0 ] ; then
        info
        exit
fi
clone $1


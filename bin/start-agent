#!/bin/bash

KEY_NAME=billy
KEY_FP=$(gpg --with-colons --list-secret-keys billy | grep ^grp | head -1 | sed -e 's/[grp:]//g')
[ -z "$KEY_FP" ] && echo "No key fingerprint found." >&2 && exit 1
echo "KEY_FP set to <$KEY_FP>"

OPTS=( "-vvv" "--daemon" "--allow-preset-passphrase" )

CMD="gpg-agent ${OPTS[@]}"
echo "CMD <$CMD>"
$CMD

echo "Enter the passphrase for the secret key to insert into the agent's cache."
CMD="/usr/lib/gnupg2/gpg-preset-passphrase --preset $KEY_FP"
echo "CMD <$CMD>"
$CMD


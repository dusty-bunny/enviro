#!/bin/bash

SDK_VERSION=0.9.3
SDK_DOWNLOADS=meta-zephyr-sdk/releases/download
SDK_BIN=zephyr-sdk-${SDK_VERSION}-setup.run
ZEPHYR_PROJECT=zephyrproject-rtos
URL_GITHUB=https://github.com
ZEPHYR_RCFILE=$HOME/.zeiphyrrc

if [ ! -f "$SDK_BIN" ]  ; then
if ! wget $URL_GITHUB/$ZEPHYR_PROJECT/$SDK_DOWNLOADS/$SDK_VERSION/$SDK_BIN ; then
        echo "!!!!!!!!!!!!!!!!!!!!!! Nada done." >&2
        exit 4
fi

#
# Remove any current values
#
sed -i -e '/^export.*ZEPHYR_TOOLCHAIN_VARIAMT=/d' -e '/^export.*ZEPHYR_SDK_INSTALL_DIR=/d' $ZEPHYR_RCFILE

#
# Insert the new values.
#
cat <<EOF >> $ZEPHYR_RCFILE
export ZEPHYR_TOOLCHAIN_VARIANT=zephyr
export ZEPHYR_SDK_INSTALL_DIR=$HOME/opt/zephyr-sdk
EOF
fi

chmod +x $SDK_BIN
echo "=== $SDK_BIN"
./$SDK_BIN

